<!DOCTYPE html>
<html xmlns:th="https://thymeleaf.org">
<head>
	<meta charset="UTF-8" name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<title>BLAZING - Team Elm</title>
	<!-- jquery -->
	<script type="application/javascript" th:src="@{https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js}"></script>
	<!-- slick.js -->
	<link rel="stylesheet" type="text/css" th:href="@{https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick.min.css}">
	<script type="application/javascript" th:src="@{https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick.min.js}"></script>
	<link rel="stylesheet" type="text/css" th:href="@{https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick-theme.min.css}">
	<!-- popper.js -->
	<script type="application/javascript" th:src="@{https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js}"></script>
	<!-- bootstrap -->
	<link rel="stylesheet" type="text/css" th:href="@{https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css}">
	<script type="application/javascript" th:src="@{https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js}"></script>
	<!-- source sans pro -->
	<link th:href='@{https://fonts.googleapis.com/css?family=Source+Sans+Pro}' rel='stylesheet' type='text/css'>
	<!-- font awesome -->
	<link th:href="@{https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css}" rel="stylesheet" type="text/css">
</head>

<link rel="stylesheet" th:href="@{/css/styles.css}">

<body class="bg-dark">
	<header th:insert="/fragments/header.html :: header"></header>
	<div class="container">
		<div class="row">
			<div class="col">
				<ul class="nav nav-tabs flex-nowrap text-center" id="tab" role="tablist">
					<li class="nav-item">
						<a class="nav-item nav-link active" id="show-reports" data-toggle="tab" href="#reports" role="tab" aria-controls="reports" aria-selected="true">Reports</a>
					</li>
					<li class="nav-item">
						<a class="nav-item nav-link" id="show-apps" data-toggle="tab" href="#apps" role="tab" aria-controls="apps" aria-selected="false">Applications</a>
					</li>
				</ul>
				<div class="tab-content" id="show-main-content">
					<div class="tab-pane show fade active" id="reports" role="tabpanel" aria-labelledby="show-reports">
						<section>
							<h5 class="section-header">REPORTS</h5>
							<div class="w-100 p-1 my-1 d-flex">
								<div class="pr-2" style="width: 100px;">Reported User</div>
								<div class="pr-2" style="width: 150px;">Media</div>
								<div class="pr-2" style="width: 200px;">Reported Review</div>
								<div class="pr-2">Reason</div>
							</div>
							<div class="w-100 p-1 my-1 border d-flex" th:each="report : ${reported}">
								<div class="pr-2" style="min-width: 100px; max-width: 100px;"><a th:text="|${report.user.firstName} ${report.user.lastName}|" th:href="@{/viewprofile/{id}(id=${report.user.id})}">User</a></div>
								<div class="pr-2" style="min-width: 150px; max-width: 150px;">
									<a th:text="${report.source.title}" th:if="${report.source instanceof T(com.blazing.objects.Movie)}" th:href="@{/viewmovie/{id}(id=${report.source.id})}">Media</a>
									<a th:text="${report.source.title}" th:if="${report.source instanceof T(com.blazing.objects.TV)}" th:href="@{/viewtv/{id}(id=${report.source.id})}">Media</a>
								</div>
								<div class="pr-2" style="min-width: 200px; max-width: 200px;" th:text="${report.body}">Review</div>
								<div class="pr-2" th:each="reason: ${report.getReasons()}">
									<div class="pb-2" th:text="${reason}">reason</div>
								</div>
								<div class="ml-auto d-flex">
									<div class="pr-2"><button type="button" class="btn" th:id="'rem-rvw-button'+${report.id}"><i class="fa fa-gavel"></i></button></div>
									<div class="pr-1"><button type="button" class="btn" th:id="'dis-rvw-button'+${report.id}"><i class="fa fa-times"></i></button></div>
								</div>
								<script th:inline="javascript">
								/*<![CDATA[*/
									$(function(){
										var remButton = /*[['#rem-rvw-button'+${report.id}]]*/ "#";
										var disButton = /*[['#dis-rvw-button'+${report.id}]]*/ "#";
										var repID = /*[[${report.id}]]*/ 0;
										$(remButton).on("click",function(e){
											e.preventDefault();
											$.ajax({
												type : "POST",
												url : location.href + "/removereview",
												contentType: "application/json",
												data : ""+repID,
												success : function(data) {
													console.log(data);
													if (data){
														location.reload();	
													}else{
														
													}
												},
												error : function(e) {
													console.log("ERROR: ", e);
												}
											});
										});
										$(disButton).on("click",function(e){
											e.preventDefault();
											var jsonString = JSON.stringify(app);
											$.ajax({
												type : "POST",
												url : location.href + "/dismissreview",
												contentType: "application/json",
												data : ""+repID,
												success : function(data) {
													console.log(data);
													if (data){
														location.reload();	
													}else{
														
													}
												},
												error : function(e) {
													console.log("ERROR: ", e);
												}
											});
										});
									});
								/*]]>*/
								</script>
							</div>
						</section>
					</div>
					<div class="tab-pane fade" id="apps" role="tabpanel" aria-labelledby="show-apps">
						<section>
							<h5 class="section-header">PENDING APPLICATIONS</h5>
							<div class="w-100 p-1 my-1 d-flex">
								<div class="pr-2" style="width: 100px;">User</div>
								<div class="pr-2">Description</div>
							</div>
							<div class="w-100 p-1 my-1 d-flex" th:each="app : ${applications}">
								<div class="pr-2" style="min-width: 100px; max-width: 100px;"><a th:href="@{/viewprofile/{id}(id=${app.getUser().id})}" th:text="|${app.getUser().firstName} ${app.getUser().lastName}|">User</a></div>
								<div class="pr-2" th:text="${app.body}">Description</div>
								<div class="ml-auto d-flex">
									<div class="pr-2"><button type="button" class="btn" th:id="'acc-app-button'+${app.id}"><i class="fa fa-check"></i></button></div>
									<div class="pr-1"><button type="button" class="btn" th:id="'rej-app-button'+${app.id}"><i class="fa fa-times"></i></button></div>
								</div>
								<script th:inline="javascript">
								/*<![CDATA[*/
									$(function(){
										var accButton = /*[['#acc-app-button'+${app.id}]]*/ "#";
										var rejButton = /*[['#rej-app-button'+${app.id}]]*/ "#";
										$(accButton).on("click",function(e){
											e.preventDefault();
											var id = /*[[${app.getUser().id}]]*/ 0;
											var body = /*[[${app.body}]]*/ "#";
											var app = {};
											app["body"] = body;
											app["userId"] = id;
											var jsonString = JSON.stringify(app);
											$.ajax({
												type : "POST",
												url : location.href + "/approvecritic",
												contentType: "application/json",
												data : jsonString,
												success : function(data) {
													location.reload();
												},
												error : function(e) {
													console.log("ERROR: ", e);
												}
											});
										});
										$(rejButton).on("click",function(e){
											e.preventDefault();
											var id = /*[[${app.getUser().id}]]*/ 0;
											var body = /*[[${app.body}]]*/ "";
											var app = {};
											app["body"] = body;
											app["userId"] = id;
											var jsonString = JSON.stringify(app);
											$.ajax({
												type : "POST",
												url : location.href + "/rejectcritic",
												contentType: "application/json",
												data : jsonString,
												success : function(data) {
													location.reload();
												},
												error : function(e) {
													console.log("ERROR: ", e);
												}
											});
										});
									});
								/*]]>*/
								</script>
							</div>
						</section>
					</div>
				</div>
			</div>
		</div>
	</div>
	<footer th:insert="/fragments/footer.html :: footer"></footer>
</body>

<script type="application/javascript" th:src="@{/js/properties.js}"></script>
<script type="application/javascript" th:src="@{/js/main.js}"></script>

</html>